# Modules (ES6+)

## –í–æ–ø—Ä–æ—Å—ã

1. –í —á—ë–º –æ—Å–Ω–æ–≤–Ω–∞—è —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É CommonJS (require/module.exports) –∏ ES Modules (import/export)?
  (–£–ø–æ–º—è–Ω–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å, –∑–∞–≥—Ä—É–∑–∫—É, tree-shaking, —Ü–∏–∫–ª–∏—á–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, hoisting –∏ —Ç.–¥.)

2. –ö–∞–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –º–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å –ø—Ä–∏ —Å–º–µ—à–∏–≤–∞–Ω–∏–∏ CommonJS –∏ ES Modules –≤ –æ–¥–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ?

3. –ß—Ç–æ —Ç–∞–∫–æ–µ tree-shaking –∏ –∫–∞–∫ –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–º–µ–Ω–Ω–æ —Å ES Modules (–∞ –Ω–µ —Å CommonJS)?


## –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É CommonJS (CJS) –∏ ECMAScript Modules (ESM)

–û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É CommonJS (CJS) –∏ ECMAScript Modules (ESM) –æ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—Å,
–≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏, –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π.
–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ –∫–ª—é—á–µ–≤—ã–º –∞—Å–ø–µ–∫—Ç–∞–º:

1. –°–∏–Ω—Ç–∞–∫—Å–∏—Å

CommonJS:

```js
const fs = require('fs');
const { foo } = require('./lib');

module.exports = { x: 1 };
// –∏–ª–∏
exports.x = 1;
```

ESM:

```js
import fs from 'fs'; // –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–π –∏–ª–∏ default
import { foo } from './lib';

export const x = 1;
// –∏–ª–∏
export default { x: 1 };
```

> ‚úÖ **ESM** ‚Äî –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–π, —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å.  
> ‚ùå **CJS** ‚Äî –∏–º–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–π, –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ –≤—ã–∑–æ–≤–∞—Ö —Ñ—É–Ω–∫—Ü–∏–π.

2. **–í—Ä–µ–º—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (Static vs Dynamic)**

- **CommonJS**:
  - –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è **–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**.
  - –ú–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å `require()` –≤–Ω—É—Ç—Ä–∏ —É—Å–ª–æ–≤–∏–π –∏–ª–∏ —Ñ—É–Ω–∫—Ü–∏–π:
    ```js
    if (condition) {
      const mod = require('./optional'); // ‚úÖ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è –≤ runtime
    }
    ```
- **ES Modules**:
  - –í—Å–µ `import`/`export` **—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ** ‚Äî –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–∞ –≤–µ—Ä—Ö–Ω–µ–º —É—Ä–æ–≤–Ω–µ, –±–µ–∑ —É—Å–ª–æ–≤–∏–π.
  - –†–∞–∑—Ä–µ—à–∞—é—Ç—Å—è **–¥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–¥–∞** (–Ω–∞ —ç—Ç–∞–ø–µ –ø–∞—Ä—Å–∏–Ω–≥–∞):
    ```js
    if (condition) {
      import mod from './optional'; // ‚ùå SyntaxError!
    }
    ```
  - –ù–æ –µ—Å—Ç—å **–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç** —á–µ—Ä–µ–∑ `import()` (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Promise):
    ```js
    if (condition) {
      const mod = await import('./optional'); // ‚úÖ
    }
    ```
3. **Hoisting (–≤—Å–ø–ª—ã—Ç–∏–µ)**

- **CommonJS**:
  - –ù–µ—Ç hoisting –¥–ª—è `module.exports`. –ü–æ—Ä—è–¥–æ–∫ –≤–∞–∂–µ–Ω:
    ```js
    console.log(module.exports); // {}
    module.exports = { a: 1 }; // —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑–º–µ–Ω–∏—Ç—Å—è
    ```

- **ES Modules**:
  - –≠–∫—Å–ø–æ—Ä—Ç—ã **hoisted**, –Ω–æ –≤–µ–¥—É—Ç —Å–µ–±—è –∫–∞–∫ **live bindings** (—Å–º. –Ω–∏–∂–µ).
  - –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `import` –¥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è (–Ω–æ —ç—Ç–æ –Ω–µ "–≤—Å–ø–ª—ã—Ç–∏–µ" –≤ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–º —Å–º—ã—Å–ª–µ ‚Äî –≤—Å—ë —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è –¥–æ –∑–∞–ø—É—Å–∫–∞).

4. **Live bindings (–∂–∏–≤—ã–µ —Å—Å—ã–ª–∫–∏)**

- **ESM**:
  - –ò–º–ø–æ—Ä—Ç—ã ‚Äî —ç—Ç–æ **–∂–∏–≤—ã–µ —Å—Å—ã–ª–∫–∏** –Ω–∞ –∏—Å—Ö–æ–¥–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
    ```js
    // counter.js
    export let count = 0;
    export function inc() { count++; }

    // main.js
    import { count, inc } from './counter.js';
    console.log(count); // 0
    inc();
    console.log(count); // 1 ‚Üê –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å!
    ```

- **CommonJS**:
  - `require()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç **–∫–æ–ø–∏—é –æ–±—ä–µ–∫—Ç–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –Ω–∞ –º–æ–º–µ–Ω—Ç –≤—ã–∑–æ–≤–∞**:
    ```js
    // counter.js
    let count = 0;
    exports.count = count;
    exports.inc = () => { count++; };

    // main.js
    const { count, inc } = require('./counter');
    console.log(count); // 0
    inc();
    console.log(count); // 0 ‚Üê –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å! (exports.count –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª—Å—è)
    ```

5. **Tree-shaking (—É–¥–∞–ª–µ–Ω–∏–µ –º—ë—Ä—Ç–≤–æ–≥–æ –∫–æ–¥–∞)**

- **ESM**: ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –æ—Ç–ª–∏—á–Ω–æ.  
  –ü–æ—Å–∫–æ–ª—å–∫—É –∏–º–ø–æ—Ä—Ç—ã —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ, –±–∞–Ω–¥–ª–µ—Ä—ã (Vite, Rollup, Webpack) –º–æ–≥—É—Ç —Ç–æ—á–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫–∞–∫–∏–µ —ç–∫—Å–ø–æ—Ä—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è, –∏ —É–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ.

- **CommonJS**: ‚ùå –ü–æ—á—Ç–∏ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è.  
  –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –ø—Ä–∏—Ä–æ–¥–∞ `require()` –¥–µ–ª–∞–µ—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∫—Ä–∞–π–Ω–µ —Å–ª–æ–∂–Ω—ã–º. Tree-shaking –ª–∏–±–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ª–∏–±–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–∞—Å—Ç–∏—á–Ω–æ –∏ –Ω–µ–Ω–∞–¥—ë–∂–Ω–æ.

6. **–¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**

- **CommonJS**:
  - –†–∞–±–æ—Ç–∞—é—Ç, –Ω–æ **–Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã**: –ø—Ä–∏ —Ü–∏–∫–ª–µ `A ‚Üí B ‚Üí A`, –º–æ–¥—É–ª—å `A` –≤ `B` –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å **—á–∞—Å—Ç–∏—á–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç** (—Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –±—ã–ª–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –¥–æ `require('./B')`).

- **ESM**:
  - –¢–∞–∫–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç —Ü–∏–∫–ª—ã, –Ω–æ –±–ª–∞–≥–æ–¥–∞—Ä—è **live bindings** –∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–º—É —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—é ‚Äî —Ä–∞–±–æ—Ç–∞—é—Ç **–±–æ–ª–µ–µ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ**.
  - –û–¥–Ω–∞–∫–æ –≤—Å—ë —Ä–∞–≤–Ω–æ —Å—á–∏—Ç–∞—é—Ç—Å—è –ø–ª–æ—Ö–æ–π –ø—Ä–∞–∫—Ç–∏–∫–æ–π.

7. **–ó–∞–≥—Ä—É–∑–∫–∞ –∏ —Å—Ä–µ–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**

| –ê—Å–ø–µ–∫—Ç                       | CommonJS               | ES Modules                                                                                 |
|------------------------------|------------------------|--------------------------------------------------------------------------------------------|
| **–°—Ä–µ–¥–∞**                    | –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ –¥–ª—è Node.js | –°—Ç–∞–Ω–¥–∞—Ä—Ç JS (–±—Ä–∞—É–∑–µ—Ä—ã + Node.js)                                                           |
| **–§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–æ–≤**            | `.js` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é     | –í –±—Ä–∞—É–∑–µ—Ä–∞—Ö ‚Äî `.js`; –≤ Node.js ‚Äî `.mjs` –∏–ª–∏ `"type": "module"` –≤ `package.json`            |
| **–ó–Ω–∞—á–µ–Ω–∏–µ `this` –≤ –º–æ–¥—É–ª–µ** | `module.exports`       | `undefined`                                                                                |
| **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å**            | –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞    | –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –∏–º–ø–æ—Ä—Ç—ã ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ *–ª–æ–≥–∏—á–µ—Å–∫–∏*, –Ω–æ –∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π –≤ –±—Ä–∞—É–∑–µ—Ä–µ ‚Äî –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è |

8. **–ò–Ω—Ç–µ—Ä–æ–ø–µ—Ä–∞–±–µ–ª—å–Ω–æ—Å—Ç—å**

- –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (Webpack, Vite, Node.js) –ø–æ–∑–≤–æ–ª—è—é—Ç **—Å–º–µ—à–∏–≤–∞—Ç—å CJS –∏ ESM**, –Ω–æ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏:
  - –ò–∑ ESM –º–æ–∂–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å CJS: `import pkg from 'commonjs-pkg'`
  - –ò–∑ CJS –Ω–µ–ª—å–∑—è –Ω–∞–ø—Ä—è–º—É—é –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `import` (–∫—Ä–æ–º–µ dynamic `import()` –≤ –Ω–æ–≤—ã—Ö –≤–µ—Ä—Å–∏—è—Ö Node.js)

> ‚ö†Ô∏è –í Node.js:
> - `.cjs` ‚Üí CommonJS
> - `.mjs` –∏–ª–∏ `"type": "module"` ‚Üí ESM


## –ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ CommonJS (CJS) –∏ ECMAScript Modules (ESM) –≤ –æ–¥–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ

–°–º–µ—à–∏–≤–∞–Ω–∏–µ CommonJS (CJS) –∏ ECMAScript Modules (ESM) –≤ –æ–¥–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ ‚Äî —á–∞—Å—Ç–∞—è –ø—Ä–∏—á–∏–Ω–∞ —Ç—Ä—É–¥–Ω–æ—É–ª–æ–≤–∏–º—ã—Ö –æ—à–∏–±–æ–∫,
–æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏–ª–∏ —Ä–∞–±–æ—Ç–µ –≤ Node.js.
–í–æ—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å:

1. –ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞

–í —Ñ–∞–π–ª–∞—Ö CommonJS –Ω–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å import/export (–≤—ã–∑–æ–≤–µ—Ç SyntaxError), –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Ç—Ä–∞–Ω—Å–ø–∞–π–ª–µ—Ä–æ–º.
–í —Ñ–∞–π–ª–∞—Ö ESM –Ω–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å require()/module.exports –Ω–∞–ø—Ä—è–º—É—é.

–ü—Ä–∏–º–µ—Ä –æ—à–∏–±–∫–∏ –≤ Node.js:

```js
// index.mjs (ESM)
const fs = require('fs'); // ‚ùå ReferenceError: require is not defined
```

2. –ü—Ä–æ–±–ª–µ–º—ã —Å –∏–º–ø–æ—Ä—Ç–æ–º CJS –∏–∑ ESM (–∏ –Ω–∞–æ–±–æ—Ä–æ—Ç)

**–ò–º–ø–æ—Ä—Ç CommonJS –∏–∑ ESM**

–í Node.js –∏ –±–∞–Ω–¥–ª–µ—Ä–∞—Ö CJS-–º–æ–¥—É–ª—å –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ default-—ç–∫—Å–ø–æ—Ä—Ç –æ–±—ä–µ–∫—Ç–∞:

```js
// math.cjs
exports.add = (a, b) => a + b;

// main.mjs (ESM)
import math from './math.cjs';      // ‚úÖ —Ä–∞–±–æ—Ç–∞–µ—Ç
console.log(math.add(2, 3));

// –ù–æ –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–π –∏–º–ø–æ—Ä—Ç –ù–ï –†–ê–ë–û–¢–ê–ï–¢:
import { add } from './math.cjs';   // ‚ùå undefined (–≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤)
```
> ‚ö†Ô∏è –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, Vite, Webpack) –ø—ã—Ç–∞—é—Ç—Å—è "—Å–∏–Ω—Ç–µ–∑–∏—Ä–æ–≤–∞—Ç—å" –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç—ã –∏–∑ CJS, –Ω–æ —ç—Ç–æ –Ω–µ–Ω–∞–¥—ë–∂–Ω–æ –∏ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–¥–∞.

**–ò–º–ø–æ—Ä—Ç ESM –∏–∑ CommonJS**

–í —á–∏—Å—Ç–æ–º Node.js (–±–µ–∑ —Ñ–ª–∞–≥–æ–≤) —ç—Ç–æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ require():

```js
// utils.mjs
export const helper = () => {};

// main.cjs
const utils = require('./utils.mjs'); // ‚ùå ERR_REQUIRE_ESM
```

‚úÖ –û–±—Ö–æ–¥–Ω–æ–π –ø—É—Ç—å ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç:

```js
// main.cjs
const utils = await import('./utils.mjs');
utils.helper();
```
–ù–æ —ç—Ç–æ —Ç—Ä–µ–±—É–µ—Ç async –∏ —É—Å–ª–æ–∂–Ω—è–µ—Ç –∫–æ–¥.

3. –ü–æ—Ç–µ—Ä—è tree-shaking

* –ï—Å–ª–∏ –≤—ã –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç–µ ESM-–±–∏–±–ª–∏–æ—Ç–µ–∫—É –∫–∞–∫ CJS (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ require()), tree-shaking –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.
* –ë–∞–Ω–¥–ª–µ—Ä—ã (Webpack, Rollup) –Ω–µ –º–æ–≥—É—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ require(), –ø–æ—ç—Ç–æ–º—É –ø–æ–¥–∫–ª—é—á–∞—é—Ç –≤–µ—Å—å –º–æ–¥—É–ª—å —Ü–µ–ª–∏–∫–æ–º.

> üì¶ –ü—Ä–∏–º–µ—Ä:
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ require('lodash-es') –≤–º–µ—Å—Ç–æ import { debounce } from 'lodash-es' ‚Üí –≤ –±–∞–Ω–¥–ª –ø–æ–ø–∞–¥–∞–µ—Ç –≤–µ—Å—å Lodash.

4. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

–ï—Å–ª–∏ –æ–¥–Ω–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ –¥–≤—É—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö (CJS –∏ ESM),
–∞ –≤—ã —Å–ª—É—á–∞–π–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç–µ –æ–±–∞ ‚Äî –æ–Ω–∏ –º–æ–≥—É—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è –¥–≤–∞–∂–¥—ã, –æ—Å–æ–±–µ–Ω–Ω–æ –≤ —Å–≤—è–∑–∫–µ —Å –º–æ–Ω–æ—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏ –∏–ª–∏ symlink‚Äô–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, npm link).

> üîÅ –≠—Ç–æ –ª–æ–º–∞–µ—Ç —Å–∏–Ω–≥–ª—Ç–æ–Ω—ã, –∫—ç—à–∏, –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è.


5. –ü—Ä–æ–±–ª–µ–º—ã —Å —Ç–∏–ø–∞–º–∏ –≤ TypeScript

* TypeScript –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç –∫–æ–¥ –≤ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –º–æ–¥—É–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç ("module": "commonjs" –∏–ª–∏ "es2020").
* –ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ import –≤ .ts —Ñ–∞–π–ª–µ, –Ω–æ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç–µ –≤ CJS, –∞ –∑–∞—Ç–µ–º –ø—ã—Ç–∞–µ—Ç–µ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤ —Å—Ä–µ–¥–µ ESM ‚Äî –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –ø—É—Ç–∞–Ω–∏—Ü–∞.
* –û—Å–æ–±–µ–Ω–Ω–æ –±–æ–ª—å–Ω–æ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ esModuleInterop –∏ allowSyntheticDefaultImports.

–ü—Ä–∏–º–µ—Ä:

```ts
import React from 'react'; // –≤ TS —Å esModuleInterop ‚Äî –æ–∫. –ù–æ –±–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ ‚Äî –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ runtime.
```


6. –û—à–∏–±–∫–∏ –≤ Node.js –∏–∑-–∑–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π –∏ package.json

Node.js —Å—Ç—Ä–æ–≥–æ —Ä–∞–∑–¥–µ–ª—è–µ—Ç –º–æ–¥—É–ª–∏ –ø–æ:

* –†–∞—Å—à–∏—Ä–µ–Ω–∏—é —Ñ–∞–π–ª–∞ (.cjs vs .mjs)
* –ü–æ–ª—é "type" –≤ package.json ("commonjs" –∏–ª–∏ "module")

–ï—Å–ª–∏ –≤—ã —Å–º–µ—à–∏–≤–∞–µ—Ç–µ —Ñ–æ—Ä–º–∞—Ç—ã –±–µ–∑ —è–≤–Ω–æ–≥–æ —É–∫–∞–∑–∞–Ω–∏—è ‚Äî –ø–æ–ª—É—á–∏—Ç–µ –æ—à–∏–±–∫–∏ –≤—Ä–æ–¥–µ:

* ERR_REQUIRE_ESM
* ERR_MODULE_NOT_FOUND
* Must use import to load ES Module

> üìÅ –ü—Ä–∏–º–µ—Ä:
–ü—Ä–æ–µ–∫—Ç —Å "type": "module" ‚Üí –≤—Å–µ .js —Ñ–∞–π–ª—ã —Å—á–∏—Ç–∞—é—Ç—Å—è ESM.
–ù–æ –µ—Å–ª–∏ –≤—ã –ø—ã—Ç–∞–µ—Ç–µ—Å—å require() —Ç–∞–∫–æ–π —Ñ–∞–π–ª –∏–∑ CJS-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ ‚Äî –æ—à–∏–±–∫–∞.

7. –†–∞–∑–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –≤ —Ä–∞–∑–Ω—ã—Ö —Å—Ä–µ–¥–∞—Ö

* –¢–æ, —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ Webpack (–±–ª–∞–≥–æ–¥–∞—Ä—è —Ö—É–∫–∞–º —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏), –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å—Å—è –≤ —á–∏—Å—Ç–æ–º Node.js.
* Vite (–Ω–∞ –±–∞–∑–µ ESBuild/Rollup) –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç ESM –∏ –º–æ–∂–µ—Ç –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å CJS-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã.

> üåê –≠—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ –±–æ–ª—å–Ω–æ –ø—Ä–∏ SSR (Next.js, Nuxt), –≥–¥–µ –∫–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ, –∏ –≤ Node.js.

### ‚úÖ –ö–∞–∫ –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã?

1. –í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –≤—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ (–ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ ‚Äî ESM).

2. –í Node.js:
  * –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ "type": "module" –≤ package.json –∏–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ .cjs/.mjs.
  * –î–ª—è –∏–º–ø–æ—Ä—Ç–∞ CJS –≤ ESM ‚Äî —Ç–æ–ª—å–∫–æ import pkg from 'pkg'.
  * –î–ª—è –∏–º–ø–æ—Ä—Ç–∞ ESM –≤ CJS ‚Äî —Ç–æ–ª—å–∫–æ await import(...).

3. –í –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ö ‚Äî –ø–æ—Å—Ç–∞–≤–ª—è–π—Ç–µ –æ–±–∞ —Ñ–æ—Ä–º–∞—Ç–∞ —á–µ—Ä–µ–∑ exports –≤ package.json:
  ```json
{
  "exports": {
    ".": {
      "import": "./dist/index.mjs",
      "require": "./dist/index.cjs"
    }
  }
} 
```

4. –ò–∑–±–µ–≥–∞–π—Ç–µ —Å–º–µ—à–∏–≤–∞–Ω–∏—è –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ.

5. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª–∏–Ω—Ç–µ—Ä—ã (eslint-plugin-import) –∏ —Ç–∏–ø–∏–∑–∞—Ü–∏—é (TypeScript —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏).


### –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–º–µ—à–∏–≤–∞–Ω–∏–µ CJS –∏ ESM —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –≤–æ–∑–º–æ–∂–Ω–æ, –Ω–æ:

* –£—Å–ª–æ–∂–Ω—è–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É,
* –õ–æ–º–∞–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (tree-shaking),
*  –í—ã–∑—ã–≤–∞–µ—Ç runtime-–æ—à–∏–±–∫–∏ –≤ —Ä–∞–∑–Ω—ã—Ö —Å—Ä–µ–¥–∞—Ö,
* –¢—Ä–µ–±—É–µ—Ç –≥–ª—É–±–æ–∫–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è –æ–±–µ–∏—Ö —Å–∏—Å—Ç–µ–º.
